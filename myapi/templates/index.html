<!DOCTYPE html>
<html>
<head>
  <title>My first Vue app</title>
  <script src="https://unpkg.com/vue@2"></script>
</head>
<body>
  <div id="formAdd">
		<p>Форма добавления записей</p>
		
		<p>
			<label>Тип оборудования</label>
			<select v-model="selected_type">
				<option v-for="option in options" v-bind:value="option.id">
					{% verbatim %}{{ option.name }}{% endverbatim %}
				</option>
			</select>
		</p>
		
		<p>
			<label>Серийные номера</label>
			<textarea v-model="serial_number"></textarea>
		</p>
		
		<p>
			<label>Примечание</label>
			<textarea v-model="note"></textarea>
		</p>
    <button v-on:click="sendData">Добавить</button>
  </div>
  
  <script>
		var app = new Vue({
			el: '#formAdd',
			data: {
				selected_type: '',
				serial_number: '',
				note: '',
				options: []
			},
			methods: {
        sendData() {
					const requestOptions = {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify({
							serial_number: this.serial_number,
							//type: "http://127.0.0.1:8000/api/equipment-type/" + this.selected_type.toString() + "/"
							type: this.selected_type
						})
					};
					console.log(requestOptions)
					fetch("http://127.0.0.1:8000/api/equipment/", requestOptions)
					.then(response => {
						console.log(response);
						response.json();
					})
        }
			}
		})
		fetch("http://127.0.0.1:8000/api/equipment-type/", {
			"method": "GET"
		})
		.then(response => {
			console.log(response)
			if(response.ok){
				return response.json()    
			} else{
				alert("Server returned " + response.status + " : " + response.statusText);
			}                
		})
		.then(response => {
			console.log(response)
			app.options = response
			//for (const idx in response) {
			//	app.options.push(response[idx].name)
			//}
		})
	</script>
</body>
</html>
